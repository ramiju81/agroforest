<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cloud Medical Fees mySiss</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: white;
    }

    .container {
      display: flex;
    }

    .sidebar h1 {
      color: purple;
      font-weight: bold;
      font-size: 50px;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      margin: 20px 0;
      color: purple;
      text-decoration: none;
      font-weight: bold;
    }

    .main {
      margin-left: 240px;
      flex: 1;
      background-color: white;
      padding: 20px 40px;
    }

    .acciones {
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
      gap: 30px;
    }

    .radio-column {
      display: flex;
      flex-direction: column;
      font-size: 14px;
      min-width: 180px;
    }

    .radio-column span {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .radio-column label {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
	  white-space: normal; /* Antes estaba nowrap */
	  word-break: break-word;
    }

    .archivo-botones {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .archivo-ejecutar {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px; 
	  margin-left: 5px; /* ⬅️ Añade esta línea */
    }

    .input-mock {
      padding: 6px;
      width: 180px;
      border: 1px solid #eee;
      border-radius: 4px;
      color: #666;
      font-style: italic;
      cursor: pointer;
      outline: none;
    }

.btn {
  background-color: #800080;
  border: none;
  color: white;
  font-weight: bold;
  font-size: 14px;
  border-radius: 6px;
  padding: 10px 20px;
  cursor: pointer;
    width: 130px;
}

    .btn.small {
      padding: 6px 10px;
      font-size: 13px;
    }

    .acciones-col {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2e6ff;
    }

    .acciones-col-extendida {
      display: flex;
      flex-direction: column;
      gap: 7px;
      align-items: flex-end;
      margin-top: 0px;
      margin-left: 335px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
	
.modal-content h2 {
  color: #800080;
  font-size: 22px;
  font-weight: bold;
}

.btn:hover {
  background-color: #6a006a;
}


.modal-content {
  background-color: white;
  margin: 5% auto;
  padding: 30px 25px;
  width: 95%;
  max-width: 620px;
  border-radius: 10px;
  position: relative;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  font-size: 13px;
}

.modal-content .close {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 18px;
  color: #555;
  cursor: pointer;
  transition: color 0.3s;
}

.modal-content .close:hover {
  color: #000;
}

.modal-content h2 {
  margin-top: 0;
  color: purple;
  font-size: 20px;
  margin-bottom: 18px;
}
	
#formEntidad {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  column-gap: 12px;
}

#formEntidad .form-group {
  display: flex;
  flex-direction: column;
  margin-bottom: 20px; /* Espacio vertical entre campos */
}

#formEntidad label {
  font-weight: bold;
  font-size: 13px;
  margin-bottom: 4px;
  color: #333;
  display: block;
}

#formEntidad .form-group {
  display: flex;
  flex-direction: column;
}

#formEntidad input,
#formEntidad select {
  padding: 8px;
  font-size: 13px;
  border: 1px solid #bbb;
  border-radius: 4px;
  width: 100%;
  box-sizing: border-box;
}

#formEntidad .form-actions {
  grid-column: span 2;
  text-align: center;
  margin-top: 20px;
}

#formEntidad button[type="submit"] {
  grid-column: span 2;
  margin-top: 10px;
  padding: 8px 12px;
  background-color: purple;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 14px;
  cursor: pointer;
}

	.inactivo {
	  opacity: 0.5;
	  background-color: #f0f0f0;
	}
	
	
	a[href="login.html"] {
	  position: relative;
	  bottom: 10px;
	}
	
    .sidebar {
      width: 200px;
      background-color: #eee6f8;
      padding: 20px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;

	  display: flex;
	  flex-direction: column;
	  justify-content: space-between;
    }
	
	.sidebar a[href="login.html"] {
	  position: relative;
	  bottom: 30px;
	}

	.logout {
	  color: purple;
	  text-decoration: none;
	  font-weight: bold;
	}
	
  </style>
</head>
<body>
  <div class="container">
	<div class="sidebar">
	  <div class="sidebar-content">
    <h1>mySiss</h1>
      <a href="configuracion.html" >Configuración</a>
      <a href="cargue.html" style="text-decoration: underline;">Data Maestra</a>
      <a href="contratos.html" >Contratos</a>
	  </div>
	  <a href="login.html" class="logout">Cerrar sesión</a>
    </div>
  <div class="main">
    <h2>Configuración data maestra</h2>
    <div class="acciones">
      <div class="radio-column">
        <span>Tipo de dato</span>
        <label><input type="radio" name="tipoEntidad" value="medicos"> Médicos</label>
        <label><input type="radio" name="tipoEntidad" value="especialidades"> Especialidades</label>
        <label><input type="radio" name="tipoEntidad" value="tarifas"> Tarifas</label>
        <label><input type="radio" name="tipoEntidad" value="aseguradoras"> Aseguradoras</label>
        <label><input type="radio" name="tipoEntidad" value="sociedades"> Sociedad médica</label>
      </div>
      <div class="archivo-ejecutar">
        <input type="file" id="archivo" style="display:none" onchange="mostrarNombreArchivo(event)">
        <input type="text" id="nombreArchivo" class="input-mock" value="Seleccione archivo" readonly onclick="document.getElementById('archivo').click()"/>
        <button type="button" class="btn" onclick="ejecutar()" title="Ejecutar">  <i class="fas fa-play"></i> Ejecutar</button>
        <button type="button" class="btn" onclick="mostrarPopup()" title="Visualizar">  <i class="fas fa-file-upload"></i> Visualizar</button>
      </div>
      <div class="acciones-col-extendida">
        <button type="button" class="btn" onclick="abrirModalNuevo()" title="Nuevo registro">  <i class="fas fa-plus"></i> Nuevo</button>
        <button type="button" class="btn" onclick="modificarRegistro()" title="Modificar registro">  <i class="fas fa-edit"></i> Modificar</button>
        <button type="button" class="btn" onclick="inactivarSeleccionados()" title="Inactivar registro"><i class="fas fa-toggle-on"></i> Inactivar/Activar</button>
      </div>
    </div>
    <div id="resultados"></div>
  </div>
</div>

<div id="modalEntidad" class="modal">
  <div class="modal-content">
<i class="fas fa-times close" onclick="cerrarModal()" title="Cerrar"></i>
    <h2 id="tituloModal"></h2>
    <form id="formEntidad" onsubmit="guardarEntidad(event)"></form>
  </div>
</div>

<script>
const datosSimulados = {
  medicos: [
                { ID_Medico: 0006, Nombres: "Laura", Apellidos: "Gomez", Tipo_Documento: "Cedula", Documento: "1111556433", RUT: "1111556433-5", Telefono: "3115764646", Email: "laurag8120@gmail.com", Dirección: "Calle 9 # 5-45" },
                { ID_Medico: 0005, Nombres: "Juan", Apellidos: "Ortega", Tipo_Documento: "Cedula", Documento: "1002345654", RUT: "1002345654-7", Telefono: "3005644335", Email: "juanortega1234@gmail.com", Dirección: "Avenida 8 # 4-44" },
                { ID_Medico: 0004, Nombres: "Camila", Apellidos: "Reyez", Tipo_Documento: "Cedula", Documento: "74567454", RUT: "74567454-7", Telefono: "3014564646", Email: "reyescamila@outlool.com", Dirección: "Carrera 6 # 4-45" },
                { ID_Medico: 0003, Nombres: "Mario", Apellidos: "Lopez", Tipo_Documento: "Cedula", Documento: "97564243", RUT: "97564243-5", Telefono: "3112345644", Email: "mario.lopez2342@outlook.com", Dirección: "Calle 1 # 5-32" },
                { ID_Medico: 0002, Nombres: "Yeny", Apellidos: "Palacio", Tipo_Documento: "Cedula", Documento: "1020234567", RUT: "1020234567-6", Telefono: "3003434565", Email: "yenypalacio021@hotmail.com", Dirección: "Avenida 3 #34-25" },
                { ID_Medico: 0001, Nombres: "Julian", Apellidos: "Ramirez", Tipo_Documento: "Cedula", Documento: "94435555", RUT: "94435555-3", Telefono: "3134456766", Email: "jramirez@gmail.com", Dirección: "calle 5 norte #22-17" },
  ],
  especialidades: [
				{ ID_Especialidad: 8888, nombre_especialidad: "Cardiologo" },
				{ ID_Especialidad: 8889, nombre_especialidad: "Neurologo" },
				{ ID_Especialidad: 8887, nombre_especialidad: "Nutriciionista" },
				{ ID_Especialidad: 8881, nombre_especialidad: "Cirujano" },
				{ ID_Especialidad: 8883, nombre_especialidad: "Nefrologo" },
				{ ID_Especialidad: 8882, nombre_especialidad: "Optometra" },
				{ ID_Especialidad: 8885, nombre_especialidad: "Endocrinologo" },
  ],
  tarifas: [
				{ ID_Tarifa: 50001, Descripion_Servicio: "Consulta General", Valor_Tarifa: "35000", fecha_vigencia_inicio: "13/11/2024", fecha_vigencia_fin: "10/08/2027" },
				{ ID_Tarifa: 50002, Descripion_Servicio: "Radiografía", Valor_Tarifa: "45500", fecha_vigencia_inicio: "22/10/2023", fecha_vigencia_fin: "18/07/2026" },
				{ ID_Tarifa: 50003, Descripion_Servicio: "Ecografía", Valor_Tarifa: "64500", fecha_vigencia_inicio: "31/12/2024", fecha_vigencia_fin: "27/09/2027" },
				{ ID_Tarifa: 50004, Descripion_Servicio: "Laboratorio de Sangre", Valor_Tarifa: "55000", fecha_vigencia_inicio: "18/3/2025", fecha_vigencia_fin: "13/012/2027" },
				{ ID_Tarifa: 50005, Descripion_Servicio: "Consulta Especializada", Valor_Tarifa: "40000", fecha_vigencia_inicio: "31/3/2025", fecha_vigencia_fin: "26/012/2027" },
  ],
  aseguradoras: [
				{ ID_Asegurador: 100, ID_Tarifa: "50001", NIT: "6015553434", Nombre_Aseguradora: "Nueva EPS", Telefono: "900100200", Correo_Electronico: "aseg_nuevaEPS@nuevaeps.com" },
				{ ID_Asegurador: 101, ID_Tarifa: "50003", NIT: "6024436774", Nombre_Aseguradora: "Comfenalco EPS", Telefono: "900100201", Correo_Electronico: "ComfenalcoEPS@comfenalcoeps.com" },
				{ ID_Asegurador: 102, ID_Tarifa: "50001", NIT: "6013300000", Nombre_Aseguradora: "Sanitas EPS", Telefono: "900100203", Correo_Electronico: "sanitasEPS@sanitaseps.com" },
				{ ID_Asegurador: 103, ID_Tarifa: "50002", NIT: "6024444111", Nombre_Aseguradora: "SURA EPS", Telefono: "900100204", Correo_Electronico: "contactenossura@suraeps.com" },
				{ ID_Asegurador: 104, ID_Tarifa: "50005", NIT: "6013345755", Nombre_Aseguradora: "SOS EPS", Telefono: "900100205", Correo_Electronico: "sosatencion@soseps.com" },
  ],
  sociedades: [
                { ID_Sociedad: 10001, Descripción: "Medicos Asociados SAS", NIT: "900000123", Dirección: "Avenida Colombia 7-45", Telefono: "+57 300646223", Correo: "medicos@correo.com" },
                { ID_Sociedad: 10002, Descripción: "Asociación Colombiana de Pediatría (ACP)", NIT: "900001234", Dirección: "Calle 4 #9-56", Telefono: "+57 (602) 4645444", Correo: "asociación@correo.com" },
                { ID_Sociedad: 10003, Descripción: "Colegio Médico Colombiano", NIT: "800023435", Dirección: "Carrera 2 # 2-34", Telefono: "+57 (604) 2345675", Correo: "colegio@correo.com" },
                { ID_Sociedad: 10004, Descripción: "Federación Médica Colombiana (FMC)", NIT: "800324879", Dirección: "Ciudad de Cali 9-56", Telefono: "+57 (601) 4456788", Correo: "federación@correo.com" },
                { ID_Sociedad: 10005, Descripción: "Sociedad Colombiana de Cardiología y Cirugía Cardiovascular (SCC)", NIT: "900000874", Dirección: "Edificio la gran Colombia", Telefono: "+57 3154567895", Correo: "sociedad@correo.com" },
  ]
};

let tipoActivo = "medicos";
let datosTabla = [];
let modoEdicion = false;
let indiceEditando = null;

document.querySelectorAll('input[name="tipoEntidad"]').forEach(radio => {
  radio.addEventListener('change', () => {
    tipoActivo = radio.value;
  });
});

function mostrarPopup() {
  datosTabla = [...datosSimulados[tipoActivo]];
  renderizarTabla();
}

function mostrarNombreArchivo(e) {
  const archivo = e.target.files[0];
  document.getElementById("nombreArchivo").value = archivo ? archivo.name : "Seleccione archivo";
}

function ejecutar() {
  const archivo = document.getElementById("archivo").files[0];
  if (!archivo) return alert("Seleccione un archivo.");
  const tipo = archivo.name.split('.').pop().toLowerCase();
  if (!["csv", "txt", "xls", "xlsx"].includes(tipo)) {
    alert("Archivo no compatible. Solo se permiten CSV, TXT o XLS(X).");
    return;
  }
  alert("Archivo válido cargado.");
}

function renderizarTabla() {
  const contenedor = document.getElementById("resultados");
  if (!datosTabla.length) {
    contenedor.innerHTML = "<p>No hay datos para mostrar.</p>";
    return;
  }
  const headers = Object.keys(datosTabla[0]);
  let html = "<table><thead><tr><th></th>";
  headers.forEach(h => html += `<th>${h}</th>`);
  html += "</tr></thead><tbody>";
  datosTabla.forEach((row, i) => {
    const inactivo = row.inactivo ? "inactivo" : "";
    html += `<tr class="${inactivo}"><td><input type="checkbox" data-index="${i}" class="seleccionar"></td>`;
    headers.forEach(h => html += `<td>${row[h]}</td>`);
    html += "</tr>";
  });
  html += "</tbody></table>";
  contenedor.innerHTML = html;
}

function abrirModalNuevo() {
  modoEdicion = false;
  indiceEditando = null;
  abrirModal();
}

function modificarRegistro() {
  const seleccionados = document.querySelectorAll('.seleccionar:checked');
  if (seleccionados.length !== 1) {
    alert("Seleccione solo un registro.");
    return;
  }
  modoEdicion = true;
  indiceEditando = seleccionados[0].dataset.index;
  abrirModal(datosTabla[indiceEditando]);
}

function abrirModal(datos = null) {
  const modal = document.getElementById("modalEntidad");
  const form = document.getElementById("formEntidad");
  const titulo = document.getElementById("tituloModal");

  form.innerHTML = "";
  const estructura = datosSimulados[tipoActivo][0];
  const nombresSingulares = {
  medicos: "médico",
  especialidades: "especialidad",
  tarifas: "tarifa",
  aseguradoras: "aseguradora",
  sociedades: "sociedad"
};
titulo.innerText = `${modoEdicion ? "Modificar" : "Crear"} ${nombresSingulares[tipoActivo]}`;

  // Calcular el próximo ID disponible si es un nuevo registro
  let nextId = 1;
  if (!modoEdicion && datosTabla.length > 0) {
    const idField = Object.keys(estructura)[0]; // Asume que el primer campo es el ID
    const maxId = Math.max(...datosTabla.map(item => parseInt(item[idField])));
    nextId = maxId + 1;
  }

  Object.keys(estructura).forEach((campo, index) => {
    const value = datos ? datos[campo] : (index === 0 && !modoEdicion ? nextId : "");
    const readonly = index === 0 ? "readonly" : ""; // Bloquea solo el primer campo (ID)

    let inputHTML = "";
    if (campo.toLowerCase().includes("tipo_documento")) {
      inputHTML = `
        <label for="${campo}">Tipo de Documento</label>
        <select name="${campo}" required>
          <option value="">Seleccione...</option>
          <option value="Cédula" ${value === "Cédula" ? "selected" : ""}>Cédula</option>
          <option value="NIT" ${value === "NIT" ? "selected" : ""}>NIT</option>
          <option value="Pasaporte" ${value === "Pasaporte" ? "selected" : ""}>Pasaporte</option>
        </select>
      `;
    } else {
      inputHTML = `
        <label for="${campo}">${campo.replace(/_/g, " ")}</label>
        <input type="text" name="${campo}" value="${value}" ${readonly} required />
      `;
    }

    form.innerHTML += `<div class="form-group">${inputHTML}</div>`;
  });

  // --- BLOQUE PARA MÉDICOS ---
  if (tipoActivo === "medicos") {
    form.innerHTML += `
      <div style="grid-column: span 2;">
        <h4 style="margin-top:20px;">Información de Contacto</h4>
        <div id="contactoContainer" style="display:none;"></div>
        <a href="#" onclick="agregarContacto()" style="color:purple; font-weight:bold; display:inline-block; margin-top:8px;">+ Agregar contacto</a>
      </div>
    `;
    // Eliminamos la llamada automática a agregarContacto()
  }

  // --- BLOQUE PARA SOCIEDADES ---
  if (tipoActivo === "sociedades") {
    form.innerHTML += `
      <div style="grid-column: span 2;">
        <h4 style="margin-top:20px;">Médicos Asociados</h4>
        <div id="medicosContainer" style="display:none;"></div>
        <a href="#" onclick="agregarMedicoAsociado()" style="color:purple; font-weight:bold; display:inline-block; margin-top:8px;">+ Agregar médico</a>
      </div>
    `;
    // Eliminamos la llamada automática a agregarMedicoAsociado()
  }
  
  // --- Botón Guardar ---
  form.innerHTML += `
    <div class="form-actions">
      <button type="submit" class="btn">Guardar</button>
    </div>
  `;

  modal.style.display = "block";
}

function agregarContacto() {
  const container = document.getElementById("contactoContainer");
  // Mostrar el contenedor si está oculto
  if (container.style.display === "none") {
    container.style.display = "block";
  }
  
  const index = container.children.length;
  const html = `
    <div class="form-group" style="margin-bottom: 15px;">
      <label>Teléfono</label>
      <input type="text" name="telefono_${index}" required />
      <label>Email</label>
      <input type="email" name="email_${index}" required />
      <label>Dirección</label>
      <input type="text" name="direccion_${index}" required />
      <hr style="margin: 10px 0;" />
    </div>
  `;
  const div = document.createElement("div");
  div.innerHTML = html;
  container.appendChild(div);
}

function agregarMedicoAsociado() {
  const container = document.getElementById("medicosContainer");
  // Mostrar el contenedor si está oculto
  if (container.style.display === "none") {
    container.style.display = "block";
  }
  
  const index = container.children.length;
  const html = `
    <div class="form-group" style="margin-bottom: 15px;">
      <label>Nombre del Médico</label>
      <input type="text" name="medico_nombre_${index}" required />
      <label>Documento</label>
      <input type="text" name="medico_documento_${index}" required />
      <hr style="margin: 10px 0;" />
    </div>
  `;
  const div = document.createElement("div");
  div.innerHTML = html;
  container.appendChild(div);
}

function guardarEntidad(e) {
  e.preventDefault();
  
  // Validar campos de contacto si es médico
  if (tipoActivo === "medicos") {
    const contactoContainer = document.getElementById("contactoContainer");
    if (contactoContainer.style.display === "block") {
      const inputs = contactoContainer.querySelectorAll("input");
      let hasEmptyFields = false;
      
      inputs.forEach(input => {
        if (!input.value.trim()) {
          hasEmptyFields = true;
        }
      });
      
      if (hasEmptyFields) {
        alert("Por favor complete todos los campos de contacto o elimine los campos vacíos.");
        return;
      }
    }
  }
  
  // Validar campos de médicos asociados si es sociedad
  if (tipoActivo === "sociedades") {
    const medicosContainer = document.getElementById("medicosContainer");
    if (medicosContainer.style.display === "block") {
      const inputs = medicosContainer.querySelectorAll("input");
      let hasEmptyFields = false;
      
      inputs.forEach(input => {
        if (!input.value.trim()) {
          hasEmptyFields = true;
        }
      });
      
      if (hasEmptyFields) {
        alert("Por favor complete todos los campos de médicos asociados o elimine los campos vacíos.");
        return;
      }
    }
  }

  const formData = new FormData(e.target);
  const nuevoRegistro = {};
  formData.forEach((v, k) => {
    // Solo guardamos campos principales, no los de contacto/médicos asociados
    if (!k.includes("_") || k === "Tipo_documento") {
      nuevoRegistro[k] = v;
    }
  });
  
  if (modoEdicion && indiceEditando !== null) {
    datosTabla[indiceEditando] = nuevoRegistro;
  } else {
    datosTabla.unshift(nuevoRegistro);
  }
  datosSimulados[tipoActivo] = [...datosTabla];
  cerrarModal();
  renderizarTabla();
}
function cerrarModal() {
  document.getElementById("modalEntidad").style.display = "none";
}


function inactivarSeleccionados() {
  const seleccionados = document.querySelectorAll(".seleccionar:checked");

  if (seleccionados.length === 0) {
    alert("Por favor, selecciona al menos un registro para inactivar.");
    return;
  }

  seleccionados.forEach(cb => {
    const row = cb.closest("tr");
    row.classList.toggle("inactivo"); // Alterna inactivo/activo
    cb.checked = false; // Deselecciona el checkbox después
  });
}
function agregarContacto() {
  const container = document.getElementById("contactoContainer");
  const index = container.children.length;
  const html = `
    <div class="form-group" style="margin-bottom: 15px;">
      <label>Teléfono</label>
      <input type="text" name="telefono_${index}" />
      <label>Email</label>
      <input type="email" name="email_${index}" />
      <label>Dirección</label>
      <input type="text" name="direccion_${index}" />
      <hr style="margin: 10px 0;" />
    </div>
  `;
  const div = document.createElement("div");
  div.innerHTML = html;
  container.appendChild(div);
}
function agregarMedicoAsociado() {
  const container = document.getElementById("medicosContainer");
  const index = container.children.length;
  const html = `
    <div class="form-group" style="margin-bottom: 15px;">
      <label>Nombre del Médico</label>
      <input type="text" name="medico_nombre_${index}" />
      <label>Documento</label>
      <input type="text" name="medico_documento_${index}" />
      <hr style="margin: 10px 0;" />
    </div>
  `;
  const div = document.createElement("div");
  div.innerHTML = html;
  container.appendChild(div);
}


</script>
</body>
</html>
